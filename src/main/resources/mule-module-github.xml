<?xml version="1.0" encoding="UTF-8"?>
<module
    name="github-module"
    namespace="http://www.mulesoft.org/schema/mule/github-module"
    xmlns="http://www.mulesoft.org/schema/mule/module"
    xmlns:mule="http://www.mulesoft.org/schema/mule/core"
    xmlns:doc="http://www.mulesoft.org/schema/mule/documentation"
    xmlns:httpn="http://www.mulesoft.org/schema/mule/httpn"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xsi:schemaLocation="
           http://www.mulesoft.org/schema/mule/module http://www.mulesoft.org/schema/mule/module/current/mule-module.xsd
           http://www.mulesoft.org/schema/mule/core http://www.mulesoft.org/schema/mule/core/current/mule.xsd
           http://www.mulesoft.org/schema/mule/httpn http://www.mulesoft.org/schema/mule/httpn/current/mule-httpn.xsd">

    <property name="baseUri" type="string"/>
    <property name="username" type="string"/>
    <property name="password" type="string" password="true"/>

    <httpn:request-config name="github-module-httpreq-config" basePath="/">
        <httpn:request-connection host="#[mel:property.baseUri]" protocol="HTTPS" port="443">
            <httpn:authentication>
                <httpn:basic-authentication username="#[mel:property.username]" password="#[mel:property.password]"/>
            </httpn:authentication>
        </httpn:request-connection>
    </httpn:request-config>

    <operation name="get-issues">
        <parameters>
            <parameter name="q" type="string" doc:description="The search terms."/>

            <!-- These are ignored in the request for the moment. -->
            <parameter name="sort" type="string" doc:description="The sort field. Can be comments, created, or updated. Default: results are sorted by best match."/>
            <parameter name="order" type="string" doc:description="The sort order if sort parameter is provided. One of asc or desc. Default: desc"/>
        </parameters>
        <body>
            <httpn:request config-ref="github-module-httpreq-config" path="/search/issues" method="GET">
                <httpn:query-params>
                    #[mel:['q' : param.q]]
                </httpn:query-params>
            </httpn:request>
            <mule:set-payload value="#[payload]" mimeType="application/json"/>
        </body>
        <output type="get-issues-response-type"/>
    </operation>

</module>
